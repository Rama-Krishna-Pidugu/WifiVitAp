<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Offline VIT-AP Wi-Fi Login Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@900&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif;
        }
        .status-dot { height: 10px; width: 10px; border-radius: 50%; display: inline-block; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        /* Fullscreen Background Video */
        .bg-video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;     /* Cover entire viewport */
            z-index: -1;           /* Behind all content */
            pointer-events: none;  /* Do not block clicks */
            background: #000;      /* Fallback background */
                         filter: brightness(0.8); /* Less dim to show video more clearly */
        }

        /* Ultra-transparent container to show video clearly */
        .glass-card {
            background: rgba(255, 255, 255, 0.03);

            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }
        .glass-card h1,
        .glass-card p,
        .glass-card label,
        .glass-card #status-message {
            color: #ffffff !important; /* Pure white for maximum visibility */
            font-weight: 600; /* Make text bold */
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8); /* Add shadow for better readability */
        }
        .glass-card #profile-list {
            background: rgba(255, 255, 255, 0.02);
            border-color: rgba(255, 255, 255, 0.08);
        }
        .glass-card input[type="text"],
        .glass-card input[type="password"] {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
        }
        .glass-card input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        /* Modern Slide-up Modal */
        .modern-modal {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.95) 0%, rgba(30, 41, 59, 0.95) 100%);
            backdrop-filter: blur(20px) saturate(150%);
            -webkit-backdrop-filter: blur(20px) saturate(150%);
            border: 1px solid rgba(148, 163, 184, 0.2);
            box-shadow: 
                0 25px 50px -12px rgba(0, 0, 0, 0.5),
                0 0 0 1px rgba(255, 255, 255, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .modern-modal.show {
            transform: translateY(0);
        }
        .modern-modal h3 {
            background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        .modern-modal label {
            color: #e2e8f0 !important;
            font-weight: 500;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }
        .modern-modal input[type="text"],
        .modern-modal input[type="password"] {
            background: rgba(15, 23, 42, 0.6);
            border: 2px solid rgba(148, 163, 184, 0.3);
            color: #f1f5f9;
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .modern-modal input:focus {
            border-color: #60a5fa;
            box-shadow: 
                0 0 0 3px rgba(96, 165, 250, 0.1),
                inset 0 2px 4px rgba(0, 0, 0, 0.2);
            background: rgba(15, 23, 42, 0.8);
        }
        .modern-modal input::placeholder {
            color: rgba(148, 163, 184, 0.8);
        }
        .modern-modal .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            border: none;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(59, 130, 246, 0.3);
        }
        .modern-modal .btn-primary:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            transform: translateY(-1px);
            box-shadow: 0 6px 12px rgba(59, 130, 246, 0.4);
        }
        .modern-modal .btn-secondary {
            background: rgba(148, 163, 184, 0.2);
            border: 1px solid rgba(148, 163, 184, 0.3);
            color: #e2e8f0;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .modern-modal .btn-secondary:hover {
            background: rgba(148, 163, 184, 0.3);
            border-color: rgba(148, 163, 184, 0.5);
            transform: translateY(-1px);
        }
        .modern-modal .eye-button {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.3);
            color: #94a3b8;
            transition: all 0.3s ease;
        }
        .modern-modal .eye-button:hover {
            background: rgba(15, 23, 42, 0.8);
            color: #e2e8f0;
            border-color: #60a5fa;
        }
        .modal-overlay {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .modal-overlay.show {
            opacity: 1;
        }
         /* Failure Text */
         .failure-text {
             position: absolute;
             top: 50%;
             left: 50%;
             transform: translate(-50%, -50%);
             font-size: 2rem;
             font-weight: 900;
             color: rgba(255, 255, 255, 0.9);
             text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
             z-index: 4;
             opacity: 0;
             animation: text-appear 0.8s 2.6s ease-out forwards;
         }

         /* Animation Keyframes */
         @keyframes crack-appear {
             0% {
                 opacity: 0;
                 transform: scale(0) rotate(var(--rotation, 0deg));
             }
             50% {
                 opacity: 1;
                 transform: scale(1.2) rotate(var(--rotation, 0deg));
             }
             100% {
                 opacity: 1;
                 transform: scale(1) rotate(var(--rotation, 0deg));
             }
         }

         @keyframes shard-fall {
             0% {
                 opacity: 1;
                 transform: translateY(0) rotate(var(--rotation, 0deg)) scale(1);
             }
             50% {
                 opacity: 0.8;
                 transform: translateY(20px) rotate(var(--rotation, 0deg)) scale(0.9);
             }
             100% {
                 opacity: 0;
                 transform: translateY(100px) rotate(var(--rotation, 0deg)) scale(0.5);
             }
         }

         @keyframes text-appear {
             0% {
                 opacity: 0;
                 transform: translate(-50%, -50%) scale(0.5);
             }
             50% {
                 opacity: 0.8;
                 transform: translate(-50%, -50%) scale(1.1);
             }
             100% {
                 opacity: 1;
                 transform: translate(-50%, -50%) scale(1);
             }
         }

         /* Screen Shake */
         #animation-modal.failure { 
             animation: screen-shake 0.3s 1.5s ease-in-out; 
         }
                 @keyframes screen-shake {
             0%, 100% { transform: translateX(0); }
             10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
             20%, 40%, 60%, 80% { transform: translateX(5px); }
         }

         /* 3D Animated Action Buttons */
         .action-btn {
             position: relative;
             width: 32px;
             height: 32px;
             border-radius: 8px;
             border: none;
             cursor: pointer;
             transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
             display: flex;
             align-items: center;
             justify-content: center;
             background: rgba(255, 255, 255, 0.1);
             backdrop-filter: blur(10px);
             -webkit-backdrop-filter: blur(10px);
             border: 1px solid rgba(255, 255, 255, 0.2);
             box-shadow: 
                 0 2px 4px rgba(0, 0, 0, 0.1),
                 0 1px 2px rgba(255, 255, 255, 0.1) inset;
             transform-style: preserve-3d;
             perspective: 1000px;
         }

         .action-btn::before {
             content: '';
             position: absolute;
             top: 0;
             left: 0;
             right: 0;
             bottom: 0;
             border-radius: 8px;
             background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.05) 100%);
             opacity: 0;
             transition: opacity 0.3s ease;
             transform: translateZ(-1px);
         }

         .action-btn:hover {
             transform: translateY(-2px) rotateX(10deg) rotateY(5deg);
             box-shadow: 
                 0 8px 16px rgba(0, 0, 0, 0.2),
                 0 4px 8px rgba(255, 255, 255, 0.1) inset,
                 0 0 0 1px rgba(255, 255, 255, 0.3);
         }

         .action-btn:hover::before {
             opacity: 1;
         }

         .action-btn:active {
             transform: translateY(0px) rotateX(5deg) rotateY(2deg);
             box-shadow: 
                 0 2px 4px rgba(0, 0, 0, 0.2),
                 0 1px 2px rgba(255, 255, 255, 0.1) inset;
         }

         .edit-btn {
             color: #60a5fa;
         }

         .edit-btn:hover {
             background: rgba(96, 165, 250, 0.2);
             color: #93c5fd;
             box-shadow: 
                 0 8px 16px rgba(96, 165, 250, 0.3),
                 0 4px 8px rgba(96, 165, 250, 0.1) inset,
                 0 0 0 1px rgba(96, 165, 250, 0.4);
         }

         .delete-btn {
             color: #f87171;
         }

         .delete-btn:hover {
             background: rgba(248, 113, 113, 0.2);
             color: #fca5a5;
             box-shadow: 
                 0 8px 16px rgba(248, 113, 113, 0.3),
                 0 4px 8px rgba(248, 113, 113, 0.1) inset,
                 0 0 0 1px rgba(248, 113, 113, 0.4);
         }

         .action-btn svg {
             transition: all 0.3s ease;
             filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
         }

         .action-btn:hover svg {
             transform: scale(1.1);
             filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.4));
         }

         /* Pulse animation for buttons */
         @keyframes button-pulse {
             0% { transform: scale(1); }
             50% { transform: scale(1.05); }
             100% { transform: scale(1); }
         }

         .action-btn:focus {
             animation: button-pulse 0.3s ease;
             outline: none;
         }

     

        
         @keyframes signature-glow {
             0% {
                 filter: drop-shadow(0 0 5px rgba(255, 107, 107, 0.5));
             }
             25% {
                 filter: drop-shadow(0 0 5px rgba(78, 205, 196, 0.5));
             }
             50% {
                 filter: drop-shadow(0 0 5px rgba(69, 183, 209, 0.5));
             }
             75% {
                 filter: drop-shadow(0 0 5px rgba(150, 206, 180, 0.5));
             }
             100% {
                 filter: drop-shadow(0 0 5px rgba(254, 202, 87, 0.5));
             }
         }

         @keyframes signature-line-pulse {
             0%, 100% {
                 transform: scaleX(1);
                 opacity: 0.7;
             }
             50% {
                 transform: scaleX(1.2);
                 opacity: 1;
             }
         }


         /* Mini Containers */
         .mini-container {
             background: rgba(255, 255, 255, 0.05);
             ;
             border: 1px solid rgba(255, 255, 255, 0.1);
             border-radius: 6px;
             padding: 6px;
             box-shadow: 
                 0 2px 5px rgba(0, 0, 0, 0.2),
                 0 0 0 1px rgba(255, 255, 255, 0.05);
             transition: all 0.3s ease;
         }

         .mini-container:hover {
             background: rgba(255, 255, 255, 0.08);
             border-color: rgba(255, 255, 255, 0.15);
             box-shadow: 
                 0 8px 30px rgba(0, 0, 0, 0.15),
                 0 0 0 1px rgba(255, 255, 255, 0.1);
             transform: translateY(-2px);
         }

         /* Add Button */
         .add-btn {
             background: linear-gradient(135deg, #10b981 0%, #059669 100%);
             border: none;
             color: white;
             padding: 8px;
             border-radius: 12px;
             cursor: pointer;
             transition: all 0.3s ease;
             box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
         }

         .add-btn:hover {
             background: linear-gradient(135deg, #059669 0%, #047857 100%);
             transform: translateY(-2px);
             box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
         }

         .add-btn:disabled {
             background: rgba(107, 114, 128, 0.3);
             cursor: not-allowed;
             transform: none;
             box-shadow: none;
         }

         /* Large Action Buttons */
         .action-btn-large {
             padding: 16px 24px;
             border-radius: 16px;
             border: none;
             font-weight: 600;
             transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
             position: relative;
             overflow: hidden;
             cursor: pointer;
         }

         .action-btn-large::before {
             content: '';
             position: absolute;
             top: 0;
             left: -100%;
             width: 100%;
             height: 100%;
             background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
             transition: left 0.5s ease;
         }

         .action-btn-large:hover::before {
             left: 100%;
         }

         .login-btn {
             padding: 4px 8px; /* Reduced to 1/4 of the original size */
             font-size: 0.75rem; /* Smaller font size */
             border-radius: 4px; /* Adjusted for smaller buttons */
             background: linear-gradient(135deg, #10b981 0%, #059669 100%);
             color: white;
             box-shadow: 0 6px 20px rgba(16, 185, 129, 0.3);
         }

         .login-btn:hover:not(:disabled) {
             background: linear-gradient(135deg, #059669 0%, #047857 100%);
             transform: translateY(-3px);
             box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4);
         }

         .logout-btn {
             padding: 4px 8px; /* Reduced to 1/4 of the original size */
             font-size: 0.75rem; /* Smaller font size */
             border-radius: 4px; /* Adjusted for smaller buttons */
             background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
             color: white;
             box-shadow: 0 6px 20px rgba(239, 68, 68, 0.3);
         }

         .logout-btn:hover:not(:disabled) {
             background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
             transform: translateY(-3px);
             box-shadow: 0 10px 30px rgba(239, 68, 68, 0.4);
         }

         .action-btn-large:disabled {
             background: rgba(107, 114, 128, 0.3);
             color: rgba(156, 163, 175, 0.8);
             cursor: not-allowed;
             transform: none;
             box-shadow: none;
         }

         .action-btn-large:disabled::before {
             display: none;
         }

       
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <!-- Background Video (offline, looping) -->
    <video id="bg-video" class="bg-video" src="we.mp4" autoplay loop muted playsinline preload="auto" aria-hidden="true"></video>



    <!-- Main Container -->
    <div class="w-full max-w-7xl mx-auto space-y-6">
        <!-- Header Container -->
        <div class="glass-card rounded-2xl shadow-lg p-6">
            <div class="text-center">
                <h1 class="text-3xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">Wi-Fi Login Manager</h1>
                
            </div>
        </div>

        <!-- Main Content Container -->
        <div class="glass-card rounded-2xl shadow-lg p-8">
            <!-- Two Column Layout -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                
                <!-- Left Container - Profile Management -->
                <div class="space-y-4">
                    <!-- Profile Header Container -->
                    <div class="mini-container">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-white">📋 Profile Management</h3>
                            <button id="add-profile-button" class="add-btn" title="Add New Profile">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Profile List Container -->
                    <div class="mini-container">
                        <div id="profile-list" class="space-y-2 p-4 rounded-lg min-h-[250px] max-h-[350px] overflow-y-auto">
                            <!-- Profiles will be rendered here -->
                        </div>
                    </div>
                </div>
                
                <!-- Right Container - Action Buttons -->
                <div class="space-y-4">
                    <!-- Quick Actions Header -->
                   
                    
                    <!-- Login Button Container -->
                    <div class="mini-container">
                        <button id="login-button" class="w-full action-btn-large login-btn" disabled>
                            <div class="flex items-center justify-center gap-3">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
                                </svg>
                                <span class="text-lg font-semibold">Login with Selected Profile</span>
                            </div>
                        </button>
                    </div>
                    
                    <!-- Logout Button Container -->
                    <div class="mini-container">
                        <button id="logout-button" class="w-full action-btn-large logout-btn" disabled>
                            <div class="flex items-center justify-center gap-3">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                </svg>
                                <span class="text-lg font-semibold">Logout Selected Profile</span>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Container -->
        <div class="glass-card rounded-2xl shadow-lg p-4">
            <div id="status-message" class="text-center text-sm flex items-center justify-center gap-2"></div>
        </div>
    </div>



    <!-- Hidden iframe -->
    <iframe name="hidden-frame" id="hidden-frame" style="display: none;"></iframe>

    <!-- Hidden forms -->
    <form id="hidden-login-form" method="POST" target="hidden-frame" style="display:none;"><input type="hidden" id="hidden-username" name="username"><input type="hidden" id="hidden-password" name="password"><input type="hidden" name="mode" value="191"><input type="hidden" name="Login" value="Login"></form>
    <form id="hidden-logout-form" method="POST" target="hidden-frame" style="display:none;"><input type="hidden" id="hidden-logout-username" name="username"><input type="hidden" name="mode" value="193"><input type="hidden" name="Login" value="Logout"></form>
    
    <!-- Add/Edit Profile Modal -->
    <div id="profile-modal" class="fixed inset-0 flex items-end justify-center p-4 z-40 hidden">
        <div class="modal-overlay absolute inset-0"></div>
        <div class="modern-modal relative w-full max-w-md rounded-t-2xl p-6 space-y-6 border-b-0">
            <div class="flex items-center justify-between">
                <h3 id="modal-title" class="text-2xl font-bold">Add New Profile</h3>
                <button id="modal-close-button" class="text-slate-400 hover:text-white transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label for="modal-profile-name" class="block text-sm font-medium mb-2">Profile Name</label>
                    <input type="text" id="modal-profile-name" placeholder="e.g., My Phone" class="w-full px-4 py-3 rounded-xl focus:outline-none">
                </div>
                
                <div>
                    <label for="modal-username" class="block text-sm font-medium mb-2">Username</label>
                    <input type="text" id="modal-username" placeholder="Enter registration number" class="w-full px-4 py-3 rounded-xl focus:outline-none">
                </div>
                
                <div>
                    <label for="modal-password" class="block text-sm font-medium mb-2">Password</label>
                    <div class="relative">
                        <input type="password" id="modal-password" placeholder="Enter password" class="w-full px-4 py-3 pr-12 rounded-xl focus:outline-none">
                        <button id="modal-show-password-button" class="eye-button absolute inset-y-0 right-0 px-3 flex items-center rounded-r-xl">
                            <svg id="eye-open-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                                <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.02 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                            </svg>
                            <svg id="eye-closed-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z" clip-rule="evenodd" />
                                <path d="M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.741L2.335 6.578A10.025 10.025 0 01.458 10c1.274 4.057 5.02 7 9.542 7 .847 0 1.669-.105 2.454-.303z" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="flex gap-3 pt-4">
                <button id="modal-cancel-button" class="btn-secondary flex-1 px-6 py-3 rounded-xl font-medium">Cancel</button>
                <button id="modal-save-button" class="btn-primary flex-1 px-6 py-3 rounded-xl font-medium">Save Profile</button>
            </div>
        </div>
    </div>


         </div>
     </div>

    <script>
        // --- CONFIGURATION ---
        const LOGIN_URL = 'https://hfw.vitap.ac.in:8090/httpclient.html';
        const MAX_PROFILES = 5;
        const STORAGE_KEY = 'vitap-wifi-profiles';
        // --- END CONFIGURATION ---

        // DOM Elements
        const profileListDiv = document.getElementById('profile-list');
        const addProfileButton = document.getElementById('add-profile-button');
        const loginButton = document.getElementById('login-button');
        const logoutButton = document.getElementById('logout-button');
        const statusMessage = document.getElementById('status-message');
        const hiddenFrame = document.getElementById('hidden-frame');
        const hiddenLoginForm = document.getElementById('hidden-login-form');
        const hiddenLogoutForm = document.getElementById('hidden-logout-form');
        const profileModal = document.getElementById('profile-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalProfileName = document.getElementById('modal-profile-name');
        const modalUsername = document.getElementById('modal-username');
        const modalPassword = document.getElementById('modal-password');
        const modalShowPasswordButton = document.getElementById('modal-show-password-button');
        const modalCancelButton = document.getElementById('modal-cancel-button');
        const modalSaveButton = document.getElementById('modal-save-button');
        const modalCloseButton = document.getElementById('modal-close-button');
        const eyeOpenIcon = document.getElementById('eye-open-icon');
        const eyeClosedIcon = document.getElementById('eye-closed-icon');
                 const animationModal = document.getElementById('animation-modal');


        // App State
        let appData = { profiles: [], lastSelectedProfileIndex: 0 };
        let editProfileIndex = -1;



        function initialize() {
            setStatus('Initializing...', 'bg-gray-400');
            setupForms();
            addEventListeners();
            ensureBackgroundVideoPlays();
            loadDataFromLocalStorage();
            setStatus('✅ Ready to use!', 'bg-green-400');
        }
        
        function setupForms() {
            hiddenLoginForm.action = LOGIN_URL;
            hiddenLogoutForm.action = LOGIN_URL;
        }

        function addEventListeners() {
            addProfileButton.addEventListener('click', () => showProfileModal());
            loginButton.addEventListener('click', performLogin);
            logoutButton.addEventListener('click', performLogout);
            hiddenFrame.addEventListener('load', handleFrameLoad);
            modalCancelButton.addEventListener('click', hideProfileModal);
            modalSaveButton.addEventListener('click', handleModalSave);
            modalCloseButton.addEventListener('click', hideProfileModal);
            modalShowPasswordButton.addEventListener('click', () => {
                const isPassword = modalPassword.type === 'password';
                modalPassword.type = isPassword ? 'text' : 'password';
                eyeOpenIcon.classList.toggle('hidden', isPassword);
                eyeClosedIcon.classList.toggle('hidden', !isPassword);
            });
        }
        
        function enableUI() {
            loginButton.disabled = false;
            logoutButton.disabled = false;
            addProfileButton.disabled = appData.profiles.length >= MAX_PROFILES;
        }

        function loadDataFromLocalStorage() {
            try {
                const savedData = localStorage.getItem(STORAGE_KEY);
                if (savedData) {
                    appData = JSON.parse(savedData);
                }
                if (appData.profiles.length === 0) {
                    appData.profiles.push({ name: 'My First Profile', username: '', password: '' });
                    appData.lastSelectedProfileIndex = 0;
                }
                renderProfileList();
                enableUI();
            } catch (error) {
                console.error("Error loading from localStorage:", error);
                setStatus('❌ Error loading profiles.', 'bg-red-400');
            }
        }

        function saveDataToLocalStorage() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(appData));
                setStatus('✅ Profiles saved locally.', 'bg-green-400');
            } catch (error) {
                console.error("Error saving to localStorage:", error);
                setStatus('❌ Failed to save profiles.', 'bg-red-400');
            }
        }
        
        function renderProfileList() {
            profileListDiv.innerHTML = '';
            if (appData.profiles.length === 0) {
                profileListDiv.innerHTML = `<p class="text-center text-gray-400">No profiles yet. Add one!</p>`;
            } else {
                appData.profiles.forEach((profile, index) => {
                    const isChecked = index === appData.lastSelectedProfileIndex;
                    const div = document.createElement('div');
                    div.className = 'flex items-center justify-between gap-2 p-2 rounded-md hover:bg-white/20';
                    div.innerHTML = `
                        <div class="flex items-center gap-3">
                            <input type="radio" id="profile-${index}" name="profile" value="${index}" class="h-4 w-4 text-blue-500 bg-gray-700 border-gray-600 focus:ring-blue-600" ${isChecked ? 'checked' : ''}>
                            <label for="profile-${index}" class="text-gray-100 cursor-pointer">${escapeHtml(profile.name)}</label>
                        </div>
                                                 <div class="flex gap-2">
                             <button data-index="${index}" class="edit-profile-button action-btn edit-btn" title="Edit Profile">
                                 <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                 </svg>
                             </button>
                             <button data-index="${index}" class="delete-profile-button action-btn delete-btn" title="Delete Profile">
                                 <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                 </svg>
                             </button>
                         </div>
                    `;
                    profileListDiv.appendChild(div);
                });
            }
            
            profileListDiv.querySelectorAll('input[type="radio"]').forEach(radio => radio.addEventListener('change', handleProfileSelection));
            profileListDiv.querySelectorAll('.edit-profile-button').forEach(btn => btn.addEventListener('click', (e) => showProfileModal(parseInt(e.target.dataset.index, 10))));
            profileListDiv.querySelectorAll('.delete-profile-button').forEach(btn => btn.addEventListener('click', (e) => deleteProfile(parseInt(e.target.dataset.index, 10))));
            
            addProfileButton.disabled = appData.profiles.length >= MAX_PROFILES;
        }

        function handleProfileSelection(event) {
            const newIndex = parseInt(event.target.value, 10);
            if (appData.lastSelectedProfileIndex !== newIndex) {
                appData.lastSelectedProfileIndex = newIndex;
                saveDataToLocalStorage();
            }
        }

        function showProfileModal(index = -1) {
            editProfileIndex = index;
            if (index >= 0) {
                const profile = appData.profiles[index];
                modalTitle.textContent = 'Edit Profile';
                modalProfileName.value = profile.name;
                modalUsername.value = profile.username;
                modalPassword.value = profile.password;
            } else {
                modalTitle.textContent = 'Add New Profile';
                modalProfileName.value = '';
                modalUsername.value = '';
                modalPassword.value = '';
            }
            profileModal.classList.remove('hidden');
            // Trigger slide-up animation
            setTimeout(() => {
                profileModal.querySelector('.modal-overlay').classList.add('show');
                profileModal.querySelector('.modern-modal').classList.add('show');
            }, 10);
        }

        function hideProfileModal() {
            profileModal.querySelector('.modal-overlay').classList.remove('show');
            profileModal.querySelector('.modern-modal').classList.remove('show');
            // Wait for animation to complete before hiding
            setTimeout(() => {
                profileModal.classList.add('hidden');
            }, 400);
        }

        function handleModalSave() {
            const name = modalProfileName.value.trim() || 'Untitled Profile';
            const username = modalUsername.value.trim();
            const password = modalPassword.value.trim();
            if (editProfileIndex >= 0) {
                appData.profiles[editProfileIndex] = { name, username, password };
            } else {
                appData.profiles.push({ name, username, password });
                appData.lastSelectedProfileIndex = appData.profiles.length - 1;
            }
            renderProfileList();
            saveDataToLocalStorage();
            hideProfileModal();
        }
        
        function deleteProfile(index) {
            if (appData.profiles.length <= 1) {
                setStatus('Cannot delete the last profile.', 'bg-yellow-400');
                return;
            }
            if (confirm(`Are you sure you want to delete "${appData.profiles[index].name}"?`)) {
                appData.profiles.splice(index, 1);
                if (appData.lastSelectedProfileIndex >= index) {
                    appData.lastSelectedProfileIndex = Math.max(0, appData.lastSelectedProfileIndex - 1);
                }
                renderProfileList();
                saveDataToLocalStorage();
            }
        }
        
        function handleFrameLoad() {
            const currentStatus = statusMessage.textContent;
            if (currentStatus.includes('Logging in')) {
                checkConnectionStatus(true);
            } else if (currentStatus.includes('Logging out')) {
                checkConnectionStatus(false);
            }
        }

        function performLogin() {
            const profile = appData.profiles[appData.lastSelectedProfileIndex];
            if (!profile || !profile.username || !profile.password) {
                setStatus('Cannot log in. Profile is incomplete.', 'bg-red-400');
                return;
            }
            setStatus('Logging in...', 'bg-blue-400');
            hiddenLoginForm.querySelector('#hidden-username').value = profile.username;
            hiddenLoginForm.querySelector('#hidden-password').value = profile.password;
            hiddenLoginForm.submit();
        }

        function performLogout() {
            const profile = appData.profiles[appData.lastSelectedProfileIndex];
            if (!profile || !profile.username) {
                setStatus('Cannot log out. Profile username is missing.', 'bg-red-400');
                return;
            }
            setStatus('Logging out...', 'bg-yellow-400');
            hiddenLogoutForm.querySelector('#hidden-logout-username').value = profile.username;
            hiddenLogoutForm.submit();
        }
        
        function checkConnectionStatus(isLoginAttempt) {
            setStatus('Verifying Connection...', 'bg-yellow-400');
            const img = new Image();
            
            const handleSuccess = () => {
                if (isLoginAttempt) {
                    setStatus('✅ Online! Login successful.', 'bg-green-400');
                } else {
                    setStatus('✅ Connection appears active.', 'bg-green-400');
                }
            };

            const handleError = () => {
                 if (isLoginAttempt) {
                    playAnimation(false); // Only play crash animation on failure
                    setTimeout(() => setStatus('❌ Offline. Login may have failed.', 'bg-red-400'), 3500);
                } else {
                    setStatus('❌ Offline. Logout may have been successful.', 'bg-red-400');
                }
            };

            let timeout = setTimeout(handleError, 5000);
            img.onload = () => { clearTimeout(timeout); handleSuccess(); };
            img.onerror = () => { clearTimeout(timeout); handleError(); };
            img.src = 'https://www.google.com/favicon.ico?t=' + new Date().getTime();
        }

        function playAnimation(isSuccess) {
            animationModal.className = 'fixed inset-0 z-50 flex flex-col items-center justify-center text-white text-center p-4';
            if (isSuccess) {
                // Success animation is removed as per request
            } else {
                animText1.textContent = 'CONNECTION FAILED';
                animationModal.classList.add('failure');
            }
            setTimeout(() => {
                animationModal.classList.add('hidden');
            }, 3500);
        }

        function setStatus(message, colorClass) {
            statusMessage.innerHTML = `<span class="status-dot ${colorClass}"></span> ${message}`;
        }
        
        // Ensure background video autoplays on browsers that block autoplay until interaction
        function ensureBackgroundVideoPlays() {
            const video = document.getElementById('bg-video');
            if (!video) return;
            const tryPlay = () => {
                const p = video.play();
                if (p && typeof p.then === 'function') {
                    p.catch(() => {
                        const once = () => { video.play().catch(() => {}); };
                        document.addEventListener('click', once, { once: true });
                        document.addEventListener('touchstart', once, { once: true });
                    });
                }
            };
            // Attempt on load and when returning to tab
            window.addEventListener('load', tryPlay);
            document.addEventListener('visibilitychange', () => { if (!document.hidden) tryPlay(); });
        }
        
        function escapeHtml(unsafe) {
            return unsafe.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
        }

        // Export profiles function for backup
        function exportProfiles() {
            const dataStr = JSON.stringify(appData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'vitap-wifi-profiles.json';
            link.click();
            URL.revokeObjectURL(url);
        }

        // Import profiles function
        function importProfiles(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (importedData.profiles && Array.isArray(importedData.profiles)) {
                        appData = importedData;
                        renderProfileList();
                        saveDataToLocalStorage();
                        setStatus('✅ Profiles imported successfully!', 'bg-green-400');
                    } else {
                        setStatus('❌ Invalid file format.', 'bg-red-400');
                    }
                } catch (error) {
                    setStatus('❌ Error importing profiles.', 'bg-red-400');
                }
            };
            reader.readAsText(file);
        }

        document.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>
